This file contains the examples from

/opt/spark2014/share/examples/spark/spark_io/

I added the standard main.gpr file.


gnatmake use_int_io.adb
  succeeds
gnatmake use_int_io_1.adb
  succeeds
gnatmake use_int_io_2.adb 
  succeeds



SPARK Ada crashes on my laptop when running
gnatprove -P main.gpr --proof=per_path
(or on gps SPARK -> prove all -> One proof per path)

The reason is the number of paths when using proof_per_path 
can grow exponentially, and in this case this seems to happen and
then one runs out of memory.
It might not crash on a better machine with more memory or processing power. 
See below for details.

The fix is to use 
gnatprove -P main.gpr --proof=per_check
(or on gps SPARK -> prove all -> One proof per check)

It still creates quite a lot of error messages.
I am not dealing with them and considering only a subset of it

Output when running gnatprove -P test.gpr --proof=per_check
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
test.gpr is the file generated by them

gnatprove -P test.gpr  --proof=per_check
Phase 1 of 2: generation of Global contracts ...
Phase 2 of 2: flow analysis and proof ...
copy.adb:42:14: medium: precondition of main program might fail
copy.adb:133:07: medium: loop invariant might fail after first iteration
copy.adb:270:07: medium: loop invariant might fail in first iteration
copy.adb:292:73: medium: range check might fail
copy.adb:305:55: medium: range check might fail
copy.adb:347:07: medium: precondition might fail
use_int_io_2.adb:32:18: medium: precondition of main program might fail
use_int_io_1.adb:32:18: medium: precondition of main program might fail
use_int_io.adb:32:18: medium: precondition of main program might fail
hello_world.adb:31:13: medium: precondition of main program might fail
echo.adb:32:18: medium: precondition of main program might fail
use_float_io.adb:32:18: medium: precondition of main program might fail
echo_1.adb:32:18: medium: precondition of main program might fail
use_enum_io.adb:32:18: medium: precondition of main program might fail
Summary logged in /home/csetzer/Dropbox/sparkada2014/critsys2015/critsys2014/sect6/example6-15/gnatprove/gnatprove.out


Output when running gnatprove -P main.gpr --proof=per_check
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
gnatprove -P main.gpr --proof=per_check
Phase 1 of 2: generation of Global contracts ...
Phase 2 of 2: flow analysis and proof ...
spark-text_io.adb:27:09: warning: unit "Ada.Exceptions" is not referenced
spark-text_io.adb:74:13: warning: function "Get_Standard_File" is not referenced
copy.adb:42:14: medium: precondition of main program might fail
copy.adb:133:07: medium: loop invariant might fail after first iteration
copy.adb:270:07: medium: loop invariant might fail in first iteration
copy.adb:292:73: medium: range check might fail
copy.adb:305:55: medium: range check might fail
copy.adb:347:07: medium: precondition might fail
use_int_io_2.adb:32:18: medium: precondition of main program might fail
my_files.ads:25:19: warning: unit "SPARK.Text_IO.Integer_IO" is not referenced
use_int_io_1.adb:32:18: medium: precondition of main program might fail
use_int_io.adb:32:18: medium: precondition of main program might fail
hello_world.adb:31:13: medium: precondition of main program might fail
echo.adb:32:18: medium: precondition of main program might fail
use_float_io.adb:32:18: medium: precondition of main program might fail
echo_1.adb:32:18: medium: precondition of main program might fail
use_enum_io.adb:32:18: medium: precondition of main program might fail
Summary logged in /home/csetzer/Dropbox/sparkada2014/critsys2015/critsys2014/sect6/example6-15/gnatprove/gnatprove.out
csetzer@csetzer-TECRA-R940:~/Dropbox/sparkada2014/critsys2015/critsys2014/sect6/example6-15> gps main.gpr &
[2] 11262
csetzer@csetzer-TECRA-R940:~/Dropbox/sparkada2014/critsys2015/critsys2014/sect6/example6-15> Gtk-Message: Failed to load module "overlay-scrollbar"
Gtk-Message: Failed to load module "unity-gtk-module"
Gtk-Message: Failed to load module "canberra-gtk-module"




Problems when checking it using --proof=per_path
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When running 

gnatprove -P main.gpr --proof=per_path

I got the following output:

gnatprove -P main.gpr --proof=per_path
Phase 1 of 2: generation of Global contracts ...
Phase 2 of 2: flow analysis and proof ...
spark-text_io.adb:27:09: warning: unit "Ada.Exceptions" is not referenced
spark-text_io.adb:74:13: warning: function "Get_Standard_File" is not referenced

<stream>:1:1: Nothing to read from stream
Internal error
+===========================GNAT BUG DETECTED==============================+
| GPL 2015 (20150428) (spark) Program_Error unhandled signal               |
| Error detected at copy.adb:320:10                                        |
| Please submit a bug report by email to report@adacore.com.               |
| GAP members can alternatively use GNAT Tracker:                          |
| http://www.adacore.com/ section 'send a report'.                         |
| See gnatinfo.txt for full info on procedure for submitting bugs.         |
| Use a subject line meaningful to you and us to track the bug.            |
| Include the entire contents of this bug box in the report.               |
| Include the exact command that you entered.                              |
| Also include sources listed below.                                       |
| Use plain ASCII or MIME attachment(s).                                   |
+==========================================================================+

Please include these source files with error report
Note that list may not be accurate in some cases,
so please double check that the problem can still
be reproduced with the set of files listed.
Consider also -gnatd.n switch (see debug.adb).

/home/csetzer/Dropbox/sparkada2014/critsys2015/critsys2014/sect6/example6-15/copy.adb
/home/csetzer/Dropbox/sparkada2014/critsys2015/critsys2014/sect6/example6-15/my_files.ads
/home/csetzer/Dropbox/sparkada2014/critsys2015/critsys2014/sect6/example6-15/spark.ads
/home/csetzer/Dropbox/sparkada2014/critsys2015/critsys2014/sect6/example6-15/spark-text_io.ads
/home/csetzer/Dropbox/sparkada2014/critsys2015/critsys2014/sect6/example6-15/spark-text_io-integer_io.ads
/home/csetzer/Dropbox/sparkada2014/critsys2015/critsys2014/sect6/example6-15/my_number_io.ads

compilation abandoned
gnatprove: error during flow analysis and proof


